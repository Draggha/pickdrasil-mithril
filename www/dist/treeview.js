!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("mithril"),require("radio")):"function"==typeof define&&define.amd?define(["exports","mithril","radio"],b):b(a.createPickdrasil=a.createPickdrasil||{},a.m,a.radio)}(this,function(a,b,c){"use strict";function d(a){var b=[];return a.parent()&&a.parent().expanded&&!a.parent().expanded()&&b.push(F),b.join(" ")}function e(a){var b=[C];return a.isLeaf()?(b.push(E),b.push(J)):(b.push(D),a.errorCode()===S.NOT_FOUND?b.push(J):b.push(a.expanded()?H:I)),a.selected()&&b.push(G),a.highlighted()?b.push(K):a.blurred()&&b.push(L),b.join(" ")}function f(a,b){return(" "+a.className+" ").indexOf(" "+b+" ")>-1}function g(a){var b=[M];return a.isLeaf()?b.push(N):b.push(a.expanded()?P:O),b.join(" ")}function h(a){var b=[];return a.isLeaf()||(b.push(M),b.push(a.expanded()?R:Q)),b.join(" ")}function i(a){return function(c){if(!f(c.target,R)&&!f(c.target,Q)){a.selected(!a.selected());var d=a.events.onNodeClick;b.startComputation(),d&&d.call(a,c),b.endComputation()}}}function j(a){return function(d){if(!a.isLeaf()){var e=a.events.onExpanderClick;b.startComputation(),a.hasChildren()&&a.expanded(!a.expanded()),e&&(e.call(a,d),c(V.TREE_STRUCTURE_CHANGED).broadcast()),b.endComputation()}}}function k(a){return function(b,c){if(c){var d=a.events.onNodeCreate;d&&d.call(a,b)}else{var e=a.events.onNodeUpdate;e&&e.call(a,b)}}}function l(a,b,c){a.map(function(a){a.traverseChildNodes(function(a){b===a.id()&&c(a)})})}function m(a,b,c){var d=b.map(function(a){return a});a.map(function(a){a.traverseChildNodes(function(a){if(d.length>0)for(var b=0;b<d.length;b++)if(d[b]===a.id()){d.splice(b,1),c(a);break}})})}function n(a,b,c){a.map(function(a){a.traverseChildNodes(function(a){a.title().toLowerCase().indexOf(b.toLowerCase())>-1&&c(a)})})}function o(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return{onExpanderClick:a.onExpanderClick,onNodeClick:a.onNodeClick,onNodeCreate:a.onNodeCreate,onNodeUpdate:a.onNodeUpdate}}function p(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return{id:b.prop(a.id||""),type:b.prop(a.type||U.STATUS),value:b.prop(a.value),tooltip:b.prop(a.tooltip||"")}}function q(a){if(!a)throw new Error("[Initialization Error] Dataset is empty! Given dataset: "+(a.toString()||"undefined"));var d=a.root;a.state=a.state||{};var e=a.id?a.id:Y(a.title),f={parent:b.prop(a.parent),id:b.prop(e),title:function(a){var d=a;return function(a){return a&&(b.startComputation(),d=a,c(V.TREE_STRUCTURE_CHANGED).broadcast(),b.endComputation()),d}}(a.title||"New Node"),isLeaf:b.prop(a.isLeaf||!1),children:b.prop(a.children||[]),index:b.prop(a.index||0),expanded:b.prop(a.state.expanded||!1),highlighted:b.prop(a.state.highlighted||!1),blurred:b.prop(a.state.blurred||!1),selected:function(a){var c=a;return function(a){var e=this;return void 0!==a&&(c=a,b.startComputation(),a?(d.selectedNodes().map(function(a){a.selected(!1)}),d.selectedNodes([this])):d.selectedNodes(d.selectedNodes().filter(function(a){return a.id()!==e.id()})),b.endComputation()),c}}(a.state.selected||!1),events:o(a.events),metaData:(a.metaData||[]).map(function(a){return void 0!==a.type&&void 0!==a.value?p(a):void 0}).filter(function(a){return void 0!==a}),errorCode:function(a){var c=a;return function(a){return a&&(b.startComputation(),c=a,b.endComputation()),c||S.NONE}}(a.errorCode)};return f.isLeaf()||(f.createChildNode=function(a){return new Promise(function(c,e){if(a)if(a.id)if(a.title){a.root=d,a.parent=f,a.events=f.events,f.errorCode()===S.NOT_FOUND&&f.errorCode(S.NONE);var g=q(a),h=f.children();h.push(g),f.children(h),b.startComputation(),c(g),b.endComputation()}else e("[createChild] Tree node creation failed: No title given! Please ensure options.childData.title is filled with a string.");else e('[createChild] Tree node creation failed: No id given! Please ensure options.childData.id is filled with a "valid" id string. "Valid" id strings are based on HTML element ids.');else e("[createChild] Tree node creation failed: No data given! Please check your options.childData object.")})},f.hasChildren=function(){return f.children().length>0},f.traverseChildNodes=function(a){a&&(a(f),f.hasChildren()&&f.children().map(function(b){b.isLeaf()?a(b):b.traverseChildNodes(a)}))}),f.toJson=function(a){var b={title:f.title(),id:f.id(),isLeaf:f.isLeaf(),expanded:f.expanded(),highlighted:f.highlighted(),blurred:f.blurred(),selected:f.selected(),events:f.events,metaData:f.metaData.map(function(a){return{id:a.id(),value:a.value(),type:a.type(),tooltip:a.tooltip()}}),errorCode:f.errorCode()};return a&&(b.children=f.children().length>0?f.children().map(function(b){return b.toJson(a)}):[]),b},f}function r(a,c,d,e){var f=[];if(c&&c.length>0)for(var g=0,h=c.length;h>g;g++){var i=c[g];i.root=a.root,i.state=a.state||{},i.events=a.events||{};var j=q(i);j.index(e||0),d&&j.parent(d),i.children&&i.children.length>0&&(j.children=b.prop(r(a,i.children,j,g+1))),f.push(j)}return f}function s(a){var b=[];return function(){if(b.length<1){if(!a&&!a.data)throw new Error("[treeData initialization] No dataset given!");b=r({root:a.root,state:a.state||{},events:a.events||{}},a.data)}return b}}function t(a){var c=this,d=this,e=b.prop(a.events||{});a.root=this,this.treeData=s(a),this.getRootNodes=function(){return c.treeData()},this.findNodes=function(a,b){if(a)if("string"==typeof a)n(d.treeData(),a,b);else if("object"==typeof a)if(a.id&&"string"==typeof a.id)l(d.treeData(),a.id,b);else if(void 0!==a.filter){var c=a.filter(function(a){return"string"==typeof a});m(d.treeData(),c,b)}},this.selectedNodes=b.prop([]),this.Events=T,this.importData=function(a){d.treeData=s(a)},this.exportData=function(){var a=void 0;return a=function(a){return a.map(function(a){return a.toJson(!0)})||[]},{data:a(d.treeData())||[],events:e()}}}function u(a){var c={header:[ea]};return b.component(Z,a,c)}b="default"in b?b["default"]:b,c="default"in c?c["default"]:c;var v="js--treeview__container",w="js--treeview__header",x="js--treeview__treenode-title",y="js--treeview__meta-data",z="js--treeview__meta-data-icon",A="js--treeview__meta-data-icon--status-on",B="js--treeview__meta-data-icon--status-off",C="js--treeview__treenode",D="js--treeview__treenode--is-node",E="js--treeview__treenode--is-leaf",F="js--treeview__treenode--hidden",G="js--treeview__treenode--selected",H="js--treeview__treenode--expanded",I="js--treeview__treenode--collapsed",J="js--treeview__treenode--not-expandable",K="js--treeview__filtered-treenode--match",L="js--treeview__filtered-treenode--no-match",M="js--treeview__treenode-icon",N="js--treeview__treenode-icon--file",O="js--treeview__treenode-icon--folder",P="js--treeview__treenode-icon--folder-open",Q="js--treeview__treenode-icon--node-collapsed",R="js--treeview__treenode-icon--node-expanded",S={NONE:0,UNAUTHORIZED:401,NOT_FOUND:404,RETRY_WITH:449,SERVER_ERROR:500},T={node:{on:{create:"onNodeCreate",update:"onNodeUpdate",click:"onNodeClick"},expander:{on:{click:"onExpanderClick"}}}},U={STATUS:"status"},V={TREE_STRUCTURE_CHANGED:"treeStructureChanged"},W={};W.controller=function(a){return{nodeData:a.nodeData}},W.view=function(a,c,f){var l=a.nodeData;return b("ul",l.parent()?{}:{"class":v},b("li",{id:l.id(),"class":d(l),config:k(l)},[b("span",{"class":e(l),onclick:i(l)},[b("span",{"class":h(l),onclick:j(l)}),b("span",{"class":g(l)}),b("span",{"class":x},l.title()),!l.metaData||l.metaData.length<1?"":l.metaData.map(function(a){return a?W.view.createMetaDataView(a):void 0})]),f]))},W.view.createMetaDataView=function(a){var c=void 0;if(a.type()===U.STATUS){var d={"class":y};a.tooltip()&&""!==a.tooltip()&&(d.title=a.tooltip()),c=b("span",d,[b("em",{"class":z+" "+(a.value()?A:B)})])}else c=b("span",{style:{border:"1px dotted lightgray",display:"inline",fontSize:"11px",fontWeight:"bold",color:"grey",marginLeft:"5px",padding:"2px 6px 2px 2px"},title:a.tooltip()},[a.value()]);return c};var X=1,Y=function(a){return a?a.toString().toLowerCase().replace(/(\s)/g,"")+(X++).toString():"yggdrasil_treenode_"+(X++).toString()},Z={};Z.controller=function(a,b){return new t(a)},Z.view=function(a,c,d){return b("div",[b("div",{"class":w},d&&d.header?d.header.map(function(c){return b.component(c,a)}):[]),a.getRootNodes().length>0?Z.view.createTreeNodeView(a):""])},Z.view.createTreeNodeView=function(a){var c=void 0;return(c=function(a){return a.map(function(a){var d=void 0;return d=!a.isLeaf()&&a.hasChildren()?b.component(W,{nodeData:a},c(a.children())):b.component(W,{nodeData:a})})})(a.getRootNodes())};var $="js--treeview__search-label",_=void 0,aa=function(){var a=this.treeViewInstance,c=this.searchTerm,d=function(a){if(c&&""!==c){var b=a.title().toLowerCase().indexOf(c)>-1;a.highlighted(b),a.blurred(!b)}else a.highlighted(!1),a.blurred(!1)};a.getRootNodes().map(function(a){a.isLeaf()?d(a):a.traverseChildNodes(d)}),b.endComputation()},ba=function(a,d){b.startComputation();var e=d.toLowerCase();_&&(c(V.TREE_STRUCTURE_CHANGED).unsubscribe(aa),clearTimeout(_),b.endComputation());var f={treeViewInstance:a,searchTerm:e};_=setTimeout(aa.bind(f),300),c(V.TREE_STRUCTURE_CHANGED).subscribe([aa,f])},ca=function(a){this.searchTerm=function(){var b="";return function(d){return void 0!==d&&(b=d,ba(a,d)),""===d&&c(V.TREE_STRUCTURE_CHANGED).unsubscribe(aa),b}}()},da=function(a){return b("Label",{"class":$},["Filter: ",b("input",{type:"text",name:"treeview-search",oninput:b.withAttr("value",a.searchTerm),value:a.searchTerm()})])},ea={controller:ca,view:da};a["default"]=u});